<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Path to Independence | RPG</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Press+Start+2P&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --accent: #7c5cff; --secondary: #22d3ee; --danger: #ff0055;
  --card: rgba(10, 10, 25, 0.95); --font-pixel: 'Press Start 2P', cursive;
}

body, html { 
  margin: 0; padding: 0; height: 100vh; width: 100vw; 
  overflow: hidden; background: #05050a; color: #fff; font-family: 'Rajdhani', sans-serif;
}

/* INTRO STORY SYSTEM */
#introOverlay {
  position: fixed; inset: 0; background: radial-gradient(circle, #1a1a2e, #000);
  z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center;
  padding: 40px; transition: 1s;
}

#storyScroll {
  max-width: 600px; text-align: center; line-height: 1.8; margin: 20px 0;
  font-family: var(--font-pixel); font-size: 12px; color: var(--secondary);
}

/* MAIN LAYOUT: NO SCROLL */
#gameWorld {
  display: flex; flex-direction: column; height: 100vh; width: 100vw;
  background: linear-gradient(to bottom, #0f0c29, #111);
}

/* HERO AREA - ENLARGED & INTERACTIVE */
.hero-env {
  flex: 0 0 45%; position: relative; border-bottom: 4px solid #222;
  background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
}

.jail-bars {
  position: absolute; inset: 0; z-index: 10;
  background: repeating-linear-gradient(90deg, transparent, transparent 15%, #222 15%, #111 18%);
  transition: 1s;
}

.hero-sprite {
  position: absolute; bottom: 20%; left: 50%; transform: translateX(-50%);
  font-size: 120px; cursor: pointer; transition: 0.3s; z-index: 5;
  image-rendering: pixelated; filter: drop-shadow(0 0 20px var(--accent));
}
.hero-sprite:hover { transform: translateX(-50%) scale(1.1); filter: brightness(1.3); }
.hero-sprite:active { transform: translateX(-50%) scale(0.9); }

/* UI AREA - NO SCROLL */
.ui-shell { flex: 1; display: flex; flex-direction: column; padding: 15px; gap: 10px; }

.nav-tabs { display: flex; gap: 10px; height: 50px; }
.tab-btn {
  flex: 1; border: 2px solid #333; background: #111; color: #888;
  font-family: var(--font-pixel); font-size: 10px; cursor: pointer;
}
.tab-btn.active { border-color: var(--accent); color: #fff; box-shadow: 0 0 15px var(--accent); }

.panel-container { flex: 1; position: relative; }
.panel {
  position: absolute; inset: 0; background: var(--card); border-radius: 12px;
  padding: 20px; border: 1px solid #333; display: flex; flex-direction: column; justify-content: space-around;
}

/* PROGRESS BARS & INPUTS */
.quest-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #222; }
.bar-bg { background: #000; height: 20px; border-radius: 10px; border: 1px solid #444; overflow: hidden; margin: 5px 0; }
.bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--secondary)); transition: 1s; }

input[type="number"] {
  width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: #fff; font-size: 18px; text-align: center;
}

.hidden { display: none !important; }
</style>
</head>
<body>

<div id="introOverlay">
  <div id="charSetup">
    <h1 class="font-pixel" style="font-size: 18px;">SELECT YOUR AVATAR</h1>
    <div style="display:flex; gap:20px; margin: 30px;">
      <div class="char-card" onclick="pick('üõ°Ô∏è','Knight')">üõ°Ô∏è<p>Knight</p></div>
      <div class="char-card" onclick="pick('ü•∑','Rogue')">ü•∑<p>Rogue</p></div>
      <div class="char-card" onclick="pick('üßô‚Äç‚ôÇÔ∏è','Mage')">üßô‚Äç‚ôÇÔ∏è<p>Mage</p></div>
    </div>
    <input type="file" id="contractFile" style="margin-bottom:20px;">
    <button onclick="weaveStory()" class="tab-btn" style="padding:15px 30px;">WEAVE MY DESTINY</button>
  </div>

  <div id="storyDisplay" class="hidden">
    <div id="storyScroll"></div>
    <button onclick="enterWorld()" class="tab-btn" style="padding:15px 30px; margin-top:20px;">ENTER THE JAIL</button>
  </div>
</div>

<div id="gameWorld">
  <div class="hero-env">
    <div id="jailBars" class="jail-bars"></div>
    <div id="hero" class="hero-sprite" onclick="heroInteract()">üë§</div>
    <div style="position:absolute; top:10px; left:10px;" class="font-pixel">
      <span id="lvlLabel">LVL 1: PRISONER</span><br>
      <span id="xpLabel" style="color:var(--secondary)">0% XP</span>
    </div>
  </div>

  <div class="ui-shell">
    <div class="nav-tabs">
      <button class="tab-btn active" onclick="tab('q',this)">QUESTS</button>
      <button class="tab-btn" onclick="tab('v',this)">VOWS</button>
      <button class="tab-btn" onclick="tab('c',this)">CONFIG</button>
    </div>

    <div class="panel-container">
      <div id="q" class="panel">
        <div class="quest-item">
          <label>Rent Paid ($250)</label>
          <input type="checkbox" class="task" onchange="sync()">
        </div>
        <div class="quest-item">
          <label>Wednesday Meeting</label>
          <input type="checkbox" class="task" onchange="sync()">
        </div>
        <div class="quest-item">
          <label>Positive Balance</label>
          <input type="checkbox" class="task" onchange="sync()">
        </div>
        <div style="margin-top:10px;">
          <div style="display:flex; justify-content:space-between; font-size:12px;">
            <span>VAULT SAVINGS</span><span id="goldVal">$0 / $1000</span>
          </div>
          <div class="bar-bg"><div id="saveBar" class="bar-fill"></div></div>
          <input type="number" id="goldInput" value="0" oninput="sync()">
        </div>
      </div>

      <div id="v" class="panel hidden">
        <div id="vowContent" style="font-size:12px; line-height:1.4; color:#aaa;"></div>
      </div>

      <div id="c" class="panel hidden">
        <label>SYSTEM VOLUME</label>
        <input type="range" min="0" max="1" step="0.1" onchange="bgm.volume=this.value">
        <button onclick="localStorage.clear(); location.reload();" style="color:red; margin-top:20px;">DELETE DATA</button>
      </div>
    </div>
  </div>
</div>

<script>
let bgm = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-17.mp3");
bgm.loop = true;
let heroData = { icon: 'üë§', class: '', contract: '' };

function pick(icon, cls) {
  heroData.icon = icon; heroData.class = cls;
  document.querySelectorAll('.char-card').forEach(c => c.style.borderColor = '#333');
  event.currentTarget.style.borderColor = 'var(--secondary)';
}

function weaveStory() {
  const file = document.getElementById('contractFile').files[0];
  if(!file) return alert("Upload your contract to start the story!");
  
  const reader = new FileReader();
  reader.onload = (e) => {
    heroData.contract = e.target.result;
    document.getElementById('charSetup').classList.add('hidden');
    document.getElementById('storyDisplay').classList.remove('hidden');
    
    // Custom Narrative Generator
    const text = `In the year 2026, the ${heroData.class} was cast into the Dungeon of Debt. 
    To escape, they signed a Sacred Vow: "${heroData.contract.substring(0, 60)}..." 
    The bars will only break when the $1000 Vault is filled. Begin your quest.`;
    
    document.getElementById('storyScroll').innerText = text;
    document.getElementById('vowContent').innerText = heroData.contract;
  };
  reader.readAsText(file);
}

function enterWorld() {
  document.getElementById('introOverlay').style.opacity = '0';
  setTimeout(() => {
    document.getElementById('introOverlay').classList.add('hidden');
    document.getElementById('hero').innerText = heroData.icon;
    bgm.play();
  }, 1000);
}

function tab(id, btn) {
  document.querySelectorAll('.panel').forEach(p => p.classList.add('hidden'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.remove('hidden');
  btn.classList.add('active');
}

function heroInteract() {
  const s = document.getElementById('hero');
  s.style.transform = "translateX(-50%) scale(1.4) rotate(10deg)";
  setTimeout(() => s.style.transform = "translateX(-50%) scale(1)", 200);
}

function sync() {
  const tasks = document.querySelectorAll('.task');
  const allDone = Array.from(tasks).every(t => t.checked);
  const gold = document.getElementById('goldInput').value || 0;
  const percent = Math.min((gold / 1000) * 100, 100);

  document.getElementById('saveBar').style.width = percent + "%";
  document.getElementById('goldVal').innerText = `$${gold} / $1000`;
  document.getElementById('xpLabel').innerText = Math.round(percent) + "% XP";

  // Escape Logic
  if(allDone) {
    document.getElementById('jailBars').style.opacity = "0";
    document.getElementById('lvlLabel').innerText = "LVL 2: ESCAPEE";
  } else {
    document.getElementById('jailBars').style.opacity = "1";
    document.getElementById('lvlLabel').innerText = "LVL 1: PRISONER";
  }
}
</script>
</body>
</html>
